<!doctype html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Translation DB Tool</title>
<link rel="stylesheet" href="app.css">

<body>
<header class="app-header">
  <div class="brand">
    <h1>Translation DB Tool</h1>
    <small>ローカル辞書照会（CSV / XML → SQLite / FTS5）</small>
  </div>
  <div class="actions">
    <button id="themeBtn" title="テーマ切替">🌓 テーマ</button>
    <a href="/health" target="_blank" class="ghost">/health</a>
  </div>
</header>

<main class="container">
  <nav class="tabs" aria-label="モード切替">
    <button class="tab" id="tab-search" aria-selected="false">検索（一覧）</button>
    <button class="tab" id="tab-query" aria-selected="true">照会（LLM補助）</button>
  </nav>

  <!-- 検索（一覧） -->
  <section id="panel-search" class="card" role="tabpanel" aria-labelledby="tab-search" hidden>
    <div class="form-row">
      <label class="inline">キーワード
        <input id="q" type="text" placeholder="saving throw">
      </label>
      <label class="inline">size
        <input id="size" type="number" value="20" min="1" max="200">
      </label>
      <div class="btn-group">
        <button id="btnSearch" class="primary">検索</button>
        <button id="copyTable">表をTSVコピー</button>
      </div>
      <div class="status" id="searchStatus"></div>
    </div>

    <div class="table-wrap">
      <table id="searchTable" class="table" hidden>
        <thead><tr><th style="width:90px">ID</th><th>EN</th><th>JA</th><th style="width:90px">score</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- 照会（上下レイアウト） -->
  <section id="panel-query" class="card" role="tabpanel" aria-labelledby="tab-query">
    <div class="form-row">
      <label class="inline">Top-K
        <input id="topk" type="number" value="3" min="1" max="5">
      </label>
      <label class="inline">max_len
        <input id="maxlen" type="number" value="240" min="0" max="1000" title="0 で無制限">
      </label>
      <label class="inline"><input id="exact" type="checkbox" checked> 完全一致優先</label>
      <label class="inline"><input id="wb" type="checkbox"> 単語境界（フレーズは推奨）</label>
      <label class="inline">min_priority
        <input id="minprio" type="number" value="" placeholder="">
      </label>
      <div class="btn-group">
        <button id="btnRun" class="primary">照会する</button>
        <button id="copyJSONL">JSONLコピー</button>
        <button id="copyTSV">TSVコピー</button>
      </div>
      <div class="status" id="queryStatus"></div>
    </div>

    <label class="hint">ソース名フィルタ（カンマ区切り、空なら全件）</label>
    <input id="sources" type="text" placeholder="例: BG3 Official, Loca EN/Loca JP" style="width:100%;max-width:720px">

    <label class="hint">改行区切りで語/フレーズを貼る（例：saving throw）</label>
    <textarea id="terms" class="terms" placeholder="saving throw&#10;ability check&#10;Mind Sliver"></textarea>

    <div class="table-wrap">
      <table id="queryTable" class="table" hidden>
        <thead>
          <tr><th style="width:20%">Term</th><th>候補1</th><th>候補2</th><th>候補3</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>
</main>

<footer class="app-footer">
  <span>Local DB: <code>data/app.sqlite</code></span>
  <span>API: <code>/search</code>, <code>/query</code></span>
</footer>

<script defer src="app.js"></script>
</body>
</html>
